<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"	
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mypage">	
	
	<select id="mypageList" parameterType="HashMap" resultType="HashMap">
		SELECT member_id, member_name, member_pw, member_phonenum, member_email
		FROM member WHERE member_id=#{member_id}
	</select>
	
	<update id="myPageUpdate" parameterType="HashMap">
		UPDATE member
		SET member_name=#{name}, member_id=#{id}, member_phonenum=#{phonenum}, member_email=#{email}
		WHERE member_id=#{member_id}
	</update>
	
	<select id="reservation" parameterType="HashMap" resultType="HashMap">
		SELECT * FROM reservation 
		WHERE member_name=(SELECT member_name FROM member where member_id=#{id}) 
		ORDER BY reservation_no DESC LIMIT #{startPage}, #{lastPage}
	</select>
	
	<select	id="totalCount" parameterType="HashMap" resultType="HashMap">
		SELECT COUNT(*) as totalCount FROM reservation 
		WHERE member_name=(SELECT member_name FROM member where member_id=#{id})
	</select>
	
	<update id="mypageUpdatePW" parameterType="HashMap">
		UPDATE member
		SET member_pw=HEX(AES_ENCRYPT(#{pw1}, 'teamc'))
		WHERE member_id=#{member_id}
	</update>
	
	<delete id="mypageDelete" parameterType="HashMap">
		DELETE FROM member 
		WHERE member_id=#{member_id}
	</delete>
	
	<update id="reservCancel" parameterType="HashMap">
		UPDATE reservation SET reservation_status="cancel" 
		WHERE member_name=(SELECT member_name FROM member where member_id=#{id}) AND shop_no=#{shop_no}
	</update>
	
	<select id="myPageBookmark" parameterType="HashMap" resultType="HashMap">
		SELECT s.*, l.member_no FROM shop s JOIN shop_like l ON s.shop_no = l.shop_no 
		WHERE l.member_no=(SELECT member_no FROM member where member_id=#{id}) 
		ORDER BY l.shop_no DESC LIMIT #{startPage}, #{lastPage}
	</select>
	
	<select id="myPageShopList" parameterType="HashMap" resultType="HashMap">
		SELECT * FROM shop WHERE shop_no=#{shop_no}
	</select>
	
	<select	id="totalCountBookmark" parameterType="HashMap" resultType="HashMap">
		SELECT COUNT(*) as totalCountBookmark, 
		s.*, l.member_no FROM shop s JOIN shop_like l ON s.shop_no = l.shop_no 
		WHERE l.member_no=(SELECT member_no FROM member where member_id=#{id})
	</select>
	
</mapper>